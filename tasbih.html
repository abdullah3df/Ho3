<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>تسبيح وذكر الله</title>
<meta name="theme-color" content="#0f1c1a">
<style>
  :root{
    --bg:#0e1716;--bg2:#0f201e;--card:#0f2321;--edge:#163b36;
    --text:#eef8f6;--muted:#a8c9c2;--accent:#27e3a1;--ring:#173a35;
    --btn1:#1cc46f;--btn2:#0fa563;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{margin:0;min-height:100dvh;display:grid;place-items:center;
       background:
        radial-gradient(1200px 600px at 10% -10%, #154d45 0%, transparent 60%),
        radial-gradient(1000px 500px at 110% 10%, #0a3b35 0%, transparent 55%),
        linear-gradient(180deg,var(--bg),var(--bg2));
       color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Arial}
  .wrap{width:min(96vw,880px);padding:22px}
  .card{background:linear-gradient(180deg,#0f2422,var(--card));
        border:1px solid var(--edge);border-radius:26px;padding:26px;
        box-shadow:0 24px 60px rgba(0,0,0,.45);text-align:center}
  h1{margin:0 0 10px;font-weight:900;font-size:clamp(1.2rem,3vw,1.5rem)}
  .muted{color:var(--muted)}
  canvas{width:min(78vw,340px);height:min(78vw,340px);max-width:340px;max-height:340px}
  .ringWrap{display:grid;place-items:center;margin:12px auto}
  .tapHint{margin-top:8px;color:var(--muted)}
  #dhikrText{margin:10px auto 14px;line-height:1.8;text-align:center;font-size:0;opacity:0;
             transform:translateY(-6px);transition:opacity .25s, transform .25s, font-size .25s;min-height:3.2em}
  #dhikrText.show{font-size:clamp(.95rem,3.2vw,1.2rem);opacity:1;transform:translateY(0)}
  #dhikrText.shake{animation:shake .30s ease}
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(3px)}50%{transform:translateX(-3px)}75%{transform:translateX(2px)}}
  .counts{margin-top:6px}
  a.back{display:inline-block;margin-top:10px;color:#a8c9c2}
</style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>تسبيح وذكر الله</h1>
      <p class="muted">اضغط الحلقة 10 مرات، ثم تُفتح صفحة المشاركة</p>

      <div id="dhikrText">سبحان الله والحمد لله ولا إله إلا الله والله أكبر</div>

      <div class="ringWrap">
        <canvas id="ring" width="360" height="360" aria-label="حلقة التسبيح"></canvas>
        <div class="tapHint">اضغط داخل الحلقة</div>
      </div>

      <div class="counts muted">المتبقي: <b id="left">10</b> / 10 — العدّاد: <b id="count">0</b></div>
      <a class="back" href="index.html">↩ العودة لصفحة البداية</a>
    </section>
  </main>

<script>
(() => {
  const DHIKR="سبحان الله والحمد لله ولا إله إلا الله والله أكبر";
  const N=10;
  let left=N, count=0;

  const dhikrEl = document.getElementById('dhikrText');
  const leftEl  = document.getElementById('left');
  const countEl = document.getElementById('count');

  const cv = document.getElementById('ring');
  const ctx = cv.getContext('2d');

  const DPR = Math.max(1, (window.devicePixelRatio||1));
  const size = 360;
  cv.width = size*DPR; cv.height = size*DPR;

  function draw(progress){
    const w=cv.width, h=cv.height, r=Math.min(w,h)/2 - 22*DPR;
    ctx.clearRect(0,0,w,h);
    ctx.save(); ctx.translate(w/2,h/2);

    ctx.lineWidth = 16*DPR; ctx.strokeStyle = "#173a35";
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.stroke();

    const ang = progress * Math.PI*2;
    const grad = ctx.createLinearGradient(-r,0,r,0);
    grad.addColorStop(0,"#27e3a1"); grad.addColorStop(1,"#0fa563");
    ctx.strokeStyle = grad; ctx.lineCap = "round";
    ctx.beginPath(); ctx.arc(0,0,r,-Math.PI/2, -Math.PI/2 + ang); ctx.stroke();

    ctx.fillStyle="#eef8f6"; ctx.font=(18*DPR)+"px system-ui";
    ctx.textAlign="center"; ctx.fillText("اضغط هنا", 0, 8*DPR);
    ctx.restore();
  }

  function beep(){
    try{
      if(!window._ac) window._ac = new (window.AudioContext||window.webkitAudioContext)();
      const ac=window._ac;
      const o=ac.createOscillator(), g=ac.createGain();
      o.type='sine'; o.frequency.value=720; g.gain.value=.06;
      o.connect(g).connect(ac.destination);
      const t=ac.currentTime; o.start(t); g.gain.exponentialRampToValueAtTime(0.0001,t+.09); o.stop(t+.11);
    }catch{}
  }

  function showDhikr(){
    dhikrEl.textContent = سبحان الله والحمد لله ولا إله إلا الله والله أكبر;
    dhikrEl.classList.remove('show','shake'); void dhikrEl.offsetWidth;
    dhikrEl.classList.add('show','shake');
  }

  cv.addEventListener('click', () => {
    if(left<=0) return;
    if(navigator.vibrate) navigator.vibrate(15);
    beep();
    count++; left--;
    leftEl.textContent = left; countEl.textContent = count;
    showDhikr();
    draw((N-left)/N);
    if(left===0) location.href='end.html';
  });

  draw(0);
})();
</script>
</body>
</html>
